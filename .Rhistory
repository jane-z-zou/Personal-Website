df$L_24 <- as.numeric(df$L_24)
df$L_33 <- as.numeric(df$L_33)
df$L_32 <- as.numeric(df$L_32)
df <- df[(df$L_23 <= -5 | df$L_24 <= -5 | df$L_32 <= -5 | df$L_33 <= -5), ]
df <- df %>% group_by(PATIENT_ID, SITE, VISIT_DATE, `...7`) %>% slice(1)
df <- df %>% group_by(PATIENT_ID, SITE) %>% mutate(COUNTS = n_distinct(VISIT_DATE)) %>% filter(COUNTS > 1) %>% select(-COUNTS)
df <- df %>% arrange(PATIENT_ID, SITE, VISIT_DATE) %>% mutate(BASELINE = min(VISIT_DATE)) %>% mutate(DIFF_TIME = as.numeric(difftime(VISIT_DATE, BASELINE, units = "days")/365.25))
df <- df %>% arrange(PATIENT_ID, SITE, VISIT_DATE, ...7) %>% group_by(PATIENT_ID, SITE, VISIT_DATE) %>% slice(1)
baseline <- df %>% filter(DIFF_TIME == 0)
df <- df %>% filter(DIFF_TIME != 0) %>% group_by(PATIENT_ID, SITE) %>% mutate(SECOND_DATE = min(DIFF_TIME)) %>% filter(DIFF_TIME == SECOND_DATE) %>% select(-SECOND_DATE)
final <- rbind(baseline, df) %>% group_by(PATIENT_ID, SITE, VISIT_DATE) %>% arrange(PATIENT_ID, SITE, VISIT_DATE)
write.csv(final, "031224 - First2Visits.csv")
final
rm(list = ls())
df <- read_csv("~/Downloads/Glaucoma Research Volunteer/10:14 Paracentral Scotoma PD/ALL_VF_EXAMS_Pattern_Deviation__1990_2020.csv",
col_types = cols(VISIT_DATE = col_date(format = "%m/%d/%y")))
df <- df %>% filter(DISPLAY_NAME %in% c("SS-24-2 Thr", "SS242 Thr")) %>% distinct()
df$PSD_PROBABILITY <- as.numeric(df$PSD_PROBABILITY)
df$FALSE_POSITIVE_PERCENT <- as.numeric(df$FALSE_POSITIVE_PERCENT)
df$GHT <- as.numeric(df$GHT)
df$MD <- as.numeric(df$MD)
df <- df %>% filter(PSD_PROBABILITY >= 1)
df <- df %>% filter(FALSE_POSITIVE_PERCENT < 15)
df <- df %>% filter(GHT == 2 | GHT == 3)
idx_include <- c(1:27, which(colnames(df) == "L_23"),which(colnames(df) == "L_24"), which(colnames(df) == "L_32"),which(colnames(df) == "L_33"))
df <- df[colnames(df)[idx_include]]
df$L_23 <- as.numeric(df$L_23)
df$L_24 <- as.numeric(df$L_24)
df$L_33 <- as.numeric(df$L_33)
df$L_32 <- as.numeric(df$L_32)
df <- df[(df$L_23 <= -5 | df$L_24 <= -5 | df$L_32 <= -5 | df$L_33 <= -5), ]
df <- df %>% group_by(PATIENT_ID, SITE, VISIT_DATE, `...7`) %>% slice(1)
df <- df %>% group_by(PATIENT_ID, SITE) %>% mutate(COUNTS = n_distinct(VISIT_DATE)) %>% filter(COUNTS > 1) %>% select(-COUNTS)
df <- df %>% arrange(PATIENT_ID, SITE, VISIT_DATE) %>% mutate(BASELINE = min(VISIT_DATE)) %>% mutate(DIFF_TIME = as.numeric(difftime(VISIT_DATE, BASELINE, units = "days")/365.25))
df <- df %>% arrange(PATIENT_ID, SITE, VISIT_DATE, ...7) %>% group_by(PATIENT_ID, SITE, VISIT_DATE) %>% slice(1)
df
df %>% group_by(PATIENT_ID, SITE, BASELINE)
df %>% group_by(PATIENT_ID, SITE, BASELINE) %>% summarize(n_distinct(DIFF_TIME))
df %>% group_by(PATIENT_ID, SITE, BASELINE)
df %>% filter(DIFF_TIME != 0) %>% group_by(PATIENT_ID, SITE, BASELINE)
df %>% filter(DIFF_TIME != 0) %>% group_by(PATIENT_ID, SITE, BASELINE) %>% filter(DIFF_TIME %in% min(DIFF_TIME))
df <- df %>% filter(DIFF_TIME != 0) %>% group_by(PATIENT_ID, SITE, BASELINE) %>% filter(DIFF_TIME %in% min(DIFF_TIME))
compare <- read_csv("~/Downloads/Glaucoma Research Volunteer/10:14 Paracentral Scotoma PD/031224 - First2Visits.csv")
colnames(compare)[-1] <- colnames(df)
compare <- compare %>% select(-1)
df$FALSE_NEGATIVE_PERCENT <- as.numeric(df$FALSE_NEGATIVE_PERCENT)
df$...23 <- as.numeric(df$...23)
df$PSD <- as.numeric(df$PSD)
df$VFI <- as.numeric(df$VFI)
df <- df %>% arrange(PATIENT_ID, SITE, VISIT_DATE)
use <- setdiff(df, compare) %>% distinct()
my_final <- rbind(compare, use) %>% distinct() %>% group_by(PATIENT_ID, SITE, VISIT_DATE)
my_final
my_final %>% group_by(PATIENT_ID, SITE, BASELINE)
my_final %>% group_by(PATIENT_ID, SITE, BASELINE) %>% summarize(min(MD))
my_final %>% group_by(PATIENT_ID, SITE, VISIT_DATE) %>% summarize(min(MD))
write.csv(my_final, "031224 - AllVisits.csv")
library(tidyverse)
df <- read_csv("031224 - AllVisits.csv")
df %>% arrange(PATIENT_ID, SITE, VISIT_DATE)
my_final
my_final %>% group_by(PATIENT_ID, SITE, VISIT_DATE)
my_final %>% group_by(PATIENT_ID, SITE, VISIT_DATE, ...7)
my_final %>% group_by(PATIENT_ID, SITE, VISIT_DATE, ...7) %>% slice(1)
my_final <- my_final %>% group_by(PATIENT_ID, SITE, VISIT_DATE, ...7) %>% slice(1)
my_final
my_final %>% group_by(PATIENT_ID, SITE)
my_final %>% group_by(PATIENT_ID, SITE) %>% summarize(n_distinct(DIFF_TIME))
my_final %>% group_by(PATIENT_ID, SITE) %>% summarize(TIMES = n_distinct(DIFF_TIME)) %>% filter(TIMES > 1)
my_final %>% group_by(PATIENT_ID, SITE) %>% summarize(TIMES = n_distinct(DIFF_TIME)) %>% filter(TIMES > 1) %>% select(-TIMES)
my_final %>% group_by(PATIENT_ID, SITE) %>% mutate(TIMES = n_distinct(DIFF_TIME)) %>% filter(TIMES > 1) %>% select(-TIMES)
my_final <- my_final %>% group_by(PATIENT_ID, SITE) %>% mutate(TIMES = n_distinct(DIFF_TIME)) %>% filter(TIMES > 1) %>% select(-TIMES)
write.csv(my_final, "031224 - AllVisits.csv")
library(tidyverse)
df <- read_csv("031224 - AllVisits.csv")
df %>% arrange(PATIENT_ID, SITE, VISIT_DATE)
filtered_final_2 <- df %>% filter(DIFF_TIME == 0 | DIFF_TIME >= 2) %>% group_by(PATIENT_ID, SITE) %>% mutate(FOLLOW_UPS = n_distinct(DIFF_TIME) - 1) %>% filter(FOLLOW_UPS >= 5) %>% distinct()
filtered_final_2 <- filtered_final_2 %>% arrange(PATIENT_ID, SITE, VISIT_DATE, BASELINE)
filtered_final_2 %>% group_by(PATIENT_ID, SITE, VISIT_DATE)
df
df %>% filter(DIFF_TIME == 0 | DIFF_TIME >= 2) %>% group_by(PATIENT_ID, SITE) %>% mutate(FOLLOW_UPS = n_distinct(DIFF_TIME) - 1) %>% filter(FOLLOW_UPS >= 5) %>% distinct()
rm(list = ls())
df <- read_csv("~/Downloads/Glaucoma Research Volunteer/10:14 Paracentral Scotoma PD/ALL_VF_EXAMS_Pattern_Deviation__1990_2020.csv",
col_types = cols(VISIT_DATE = col_date(format = "%m/%d/%y")))
library(tidyverse)
df <- read_csv("~/Downloads/Glaucoma Research Volunteer/10:14 Paracentral Scotoma PD/ALL_VF_EXAMS_Pattern_Deviation__1990_2020.csv",
col_types = cols(VISIT_DATE = col_date(format = "%m/%d/%y")))
df <- df %>% filter(DISPLAY_NAME %in% c("SS-24-2 Thr", "SS242 Thr")) %>% distinct()
df$PSD_PROBABILITY <- as.numeric(df$PSD_PROBABILITY)
df$FALSE_POSITIVE_PERCENT <- as.numeric(df$FALSE_POSITIVE_PERCENT)
df$GHT <- as.numeric(df$GHT)
df$MD <- as.numeric(df$MD)
df <- df %>% filter(PSD_PROBABILITY >= 1)
df <- df %>% filter(FALSE_POSITIVE_PERCENT < 15)
df <- df %>% filter(GHT == 2 | GHT == 3)
df <- df %>% filter(MD > -6)
idx_include <- c(1:27, which(colnames(df) == "L_23"),which(colnames(df) == "L_24"), which(colnames(df) == "L_32"),which(colnames(df) == "L_33"))
df <- df[colnames(df)[idx_include]]
df$L_23 <- as.numeric(df$L_23)
df$L_24 <- as.numeric(df$L_24)
df$L_33 <- as.numeric(df$L_33)
df$L_32 <- as.numeric(df$L_32)
df <- df[(df$L_23 <= -5 | df$L_24 <= -5 | df$L_32 <= -5 | df$L_33 <= -5), ]
df <- df %>% group_by(PATIENT_ID, SITE, VISIT_DATE, `...7`) %>% slice(1)
df <- df %>% group_by(PATIENT_ID, SITE) %>% mutate(COUNTS = n_distinct(VISIT_DATE)) %>% filter(COUNTS > 1) %>% select(-COUNTS)
df <- df %>% arrange(PATIENT_ID, SITE, VISIT_DATE) %>% mutate(BASELINE = min(VISIT_DATE)) %>% mutate(DIFF_TIME = as.numeric(difftime(VISIT_DATE, BASELINE, units = "days")/365.25))
df
df %>% group_by(PATIENT_ID, SITE, VISIT_DATE)
df %>% group_by(PATIENT_ID, SITE, VISIT_DATE, ...7)
df %>% group_by(PATIENT_ID, SITE, VISIT_DATE) %>% arrange(PATIENT_ID, SITE, VISIT_DATE, ...7)
df %>% group_by(PATIENT_ID, SITE, VISIT_DATE) %>% arrange(PATIENT_ID, SITE, VISIT_DATE, ...7) %>% slice(1)
df %>% group_by(PATIENT_ID, SITE, VISIT_DATE) %>% arrange(PATIENT_ID, SITE, VISIT_DATE, ...7) %>% slice(1) %>% distinct()
df <- df %>% group_by(PATIENT_ID, SITE, VISIT_DATE) %>% arrange(PATIENT_ID, SITE, VISIT_DATE, ...7) %>% slice(1) %>% distinct()
baseline <- df %>% filter(DIFF_TIME == 0)
df %>% filter(DIFF_TIME != 0) %>% group_by(PATIENT_ID, SITE) %>% mutate(SECOND_DATE = min(DIFF_TIME)) %>% filter(DIFF_TIME == SECOND_DATE) %>% select(-SECOND_DATE)
df %>% filter(DIFF_TIME != 0) %>% group_by(PATIENT_ID, SITE) %>% mutate(SECOND_DATE = min(DIFF_TIME)) %>% filter(DIFF_TIME == SECOND_DATE)
df %>% filter(DIFF_TIME != 0) %>% group_by(PATIENT_ID, SITE) %>% mutate(SECOND_DATE = min(DIFF_TIME)) %>% filter(which(DIFF_TIME = SECOND_DATE))
df %>% filter(DIFF_TIME != 0) %>% group_by(PATIENT_ID, SITE) %>% mutate(SECOND_DATE = min(DIFF_TIME)) %>% filter(which(DIFF_TIME == SECOND_DATE))
df %>% filter(DIFF_TIME != 0) %>% group_by(PATIENT_ID, SITE) %>% mutate(SECOND_DATE = min(DIFF_TIME))
df %>% filter(DIFF_TIME != 0) %>% group_by(PATIENT_ID, SITE) %>% mutate(SECOND_DATE = min(DIFF_TIME)) %>% filter(DIFF_TIME == SECOND_DATE)
df <- df %>% filter(DIFF_TIME != 0) %>% group_by(PATIENT_ID, SITE) %>% mutate(SECOND_DATE = min(DIFF_TIME)) %>% filter(DIFF_TIME == SECOND_DATE)
df
df <- df %>% select(-SECOND_DATE)
final <- rbind(baseline, df) %>% group_by(PATIENT_ID, SITE, VISIT_DATE) %>% arrange(PATIENT_ID, SITE, VISIT_DATE)
final
final %>% group_by(PATIENT_ID, SITE)
final %>% group_by(PATIENT_ID, SITE) %>% summarize(min(MD))
write.csv(final, "031224 - First2Visits.csv")
rm(list = ls())
df <- read_csv("~/Downloads/Glaucoma Research Volunteer/10:14 Paracentral Scotoma PD/ALL_VF_EXAMS_Pattern_Deviation__1990_2020.csv",
col_types = cols(VISIT_DATE = col_date(format = "%m/%d/%y")))
df <- df %>% filter(DISPLAY_NAME %in% c("SS-24-2 Thr", "SS242 Thr")) %>% distinct()
df$PSD_PROBABILITY <- as.numeric(df$PSD_PROBABILITY)
df$FALSE_POSITIVE_PERCENT <- as.numeric(df$FALSE_POSITIVE_PERCENT)
df$GHT <- as.numeric(df$GHT)
df$MD <- as.numeric(df$MD)
df <- df %>% filter(PSD_PROBABILITY >= 1)
df <- df %>% filter(FALSE_POSITIVE_PERCENT < 15)
df <- df %>% filter(GHT == 2 | GHT == 3)
idx_include <- c(1:27, which(colnames(df) == "L_23"),which(colnames(df) == "L_24"), which(colnames(df) == "L_32"),which(colnames(df) == "L_33"))
df <- df[colnames(df)[idx_include]]
df$L_23 <- as.numeric(df$L_23)
df$L_24 <- as.numeric(df$L_24)
df$L_33 <- as.numeric(df$L_33)
df$L_32 <- as.numeric(df$L_32)
df <- df[(df$L_23 <= -5 | df$L_24 <= -5 | df$L_32 <= -5 | df$L_33 <= -5), ]
df <- df %>% group_by(PATIENT_ID, SITE, VISIT_DATE, `...7`) %>% slice(1)
df <- df %>% group_by(PATIENT_ID, SITE) %>% mutate(COUNTS = n_distinct(VISIT_DATE)) %>% filter(COUNTS > 1) %>% select(-COUNTS)
df <- df %>% arrange(PATIENT_ID, SITE, VISIT_DATE) %>% mutate(BASELINE = min(VISIT_DATE)) %>% mutate(DIFF_TIME = as.numeric(difftime(VISIT_DATE, BASELINE, units = "days")/365.25))
df <- df %>% group_by(PATIENT_ID, SITE, VISIT_DATE) %>% arrange(PATIENT_ID, SITE, VISIT_DATE, ...7) %>% slice(1) %>% distinct()
df
df %>% group_by(PATIENT_ID, SITE)
df %>% group_by(PATIENT_ID, SITE) %>% arrange(PATIENT_ID, SITE, VISIT_DATE)
df %>% group_by(PATIENT_ID, SITE, VISIT_DATE)
df %>% arrange(PATIENT_ID, SITE, VISIT_DATE)
df %>% group_by(PATIENT_ID, SITE) %>% arrange(PATIENT_ID, SITE)
df %>% group_by(PATIENT_ID, SITE) %>% arrange(PATIENT_ID, SITE) %>% slice(1:2)
df %>% group_by(PATIENT_ID, SITE) %>% arrange(PATIENT_ID, SITE) %>% slice(-(1:2))
df <- df %>% group_by(PATIENT_ID, SITE) %>% arrange(PATIENT_ID, SITE) %>% slice(-(1:2))
compare <- read_csv("~/Downloads/Glaucoma Research Volunteer/10:14 Paracentral Scotoma PD/031224 - First2Visits.csv")
colnames(compare)[-1] <- colnames(df)
compare <- compare %>% select(-1)
df$FALSE_NEGATIVE_PERCENT <- as.numeric(df$FALSE_NEGATIVE_PERCENT)
df$...23 <- as.numeric(df$...23)
df$PSD <- as.numeric(df$PSD)
df$VFI <- as.numeric(df$VFI)
use <- setdiff(df, compare) %>% distinct()
setdiff
use
my_final <- rbind(compare, use) %>% distinct() %>% group_by(PATIENT_ID, SITE, VISIT_DATE)
my_final
my_final <- rbind(compare, use) %>% distinct() %>% group_by(PATIENT_ID, SITE, VISIT_DATE) %>% arrange(PATIENT_ID, SITE, VISIT_DATE, ...7)
my_final
my_final <- my_final %>% group_by(PATIENT_ID, SITE, VISIT_DATE, ...7) %>% slice(1)
my_final
write.csv(my_final, "031224 - AllVisits.csv")
my_final
my_final
my_final %>% group_by(PATIENT_ID, VISIT_DATE, SITE, BASELINE)
my_final %>% group_by(PATIENT_ID, SITE)
my_final %>% group_by(PATIENT_ID, SITE) %>% filter(any(VISIT_DATE != BASELINE))
my_final
rm(list = ls())
df <- read_csv("~/Downloads/Glaucoma Research Volunteer/10:14 Paracentral Scotoma PD/ALL_VF_EXAMS_Pattern_Deviation__1990_2020.csv",
col_types = cols(VISIT_DATE = col_date(format = "%m/%d/%y")))
df <- df %>% filter(DISPLAY_NAME %in% c("SS-24-2 Thr", "SS242 Thr")) %>% distinct()
df$PSD_PROBABILITY <- as.numeric(df$PSD_PROBABILITY)
df$FALSE_POSITIVE_PERCENT <- as.numeric(df$FALSE_POSITIVE_PERCENT)
df$GHT <- as.numeric(df$GHT)
df$MD <- as.numeric(df$MD)
df <- df %>% filter(PSD_PROBABILITY >= 1)
df <- df %>% filter(FALSE_POSITIVE_PERCENT < 15)
df <- df %>% filter(GHT == 2 | GHT == 3)
idx_include <- c(1:27, which(colnames(df) == "L_23"),which(colnames(df) == "L_24"), which(colnames(df) == "L_32"),which(colnames(df) == "L_33"))
df <- df[colnames(df)[idx_include]]
df$L_23 <- as.numeric(df$L_23)
df$L_24 <- as.numeric(df$L_24)
df$L_33 <- as.numeric(df$L_33)
df$L_32 <- as.numeric(df$L_32)
df <- df[(df$L_23 <= -5 | df$L_24 <= -5 | df$L_32 <= -5 | df$L_33 <= -5), ]
df <- df %>% group_by(PATIENT_ID, SITE, VISIT_DATE, `...7`) %>% slice(1)
df <- df %>% group_by(PATIENT_ID, SITE) %>% mutate(COUNTS = n_distinct(VISIT_DATE)) %>% filter(COUNTS > 1) %>% select(-COUNTS)
df <- df %>% arrange(PATIENT_ID, SITE, VISIT_DATE) %>% mutate(BASELINE = min(VISIT_DATE)) %>% mutate(DIFF_TIME = as.numeric(difftime(VISIT_DATE, BASELINE, units = "days")/365.25))
df <- df %>% group_by(PATIENT_ID, SITE, VISIT_DATE) %>% arrange(PATIENT_ID, SITE, VISIT_DATE, ...7) %>% slice(1) %>% distinct()
df <- df %>% group_by(PATIENT_ID, SITE) %>% arrange(PATIENT_ID, SITE) %>% slice(-(1:2))
compare <- read_csv("~/Downloads/Glaucoma Research Volunteer/10:14 Paracentral Scotoma PD/031224 - First2Visits.csv")
colnames(compare)[-1] <- colnames(df)
compare <- compare %>% select(-1)
df$FALSE_NEGATIVE_PERCENT <- as.numeric(df$FALSE_NEGATIVE_PERCENT)
df$...23 <- as.numeric(df$...23)
df$PSD <- as.numeric(df$PSD)
df$VFI <- as.numeric(df$VFI)
df %>% filter(PATIENT_ID %in% compare$PATIENT_ID)
df %>% filter(PATIENT_ID %in% compare$PATIENT_ID) %>% group_by(PATIENT_ID, SITE, VISIT_DATE)
df <- df %>% filter(PATIENT_ID %in% compare$PATIENT_ID)
use <- setdiff(df, compare) %>% distinct()
yse
use
my_final <- rbind(compare, use) %>% distinct() %>% group_by(PATIENT_ID, SITE, VISIT_DATE) %>% arrange(PATIENT_ID, SITE, VISIT_DATE, ...7)
my_final <- my_final %>% group_by(PATIENT_ID, SITE, VISIT_DATE, ...7) %>% slice(1)
my_final
my_final %>% arrange(PATIENT_ID, SITE, VISIT_DATE)
my_final %>% arrange(PATIENT_ID, SITE, VISIT_DATE) %>% group_by(PATIENT_ID, SITE)
my_final %>% arrange(PATIENT_ID, SITE, VISIT_DATE)
my_final %>% arrange(PATIENT_ID, SITE, VISIT_DATE) %>% summarize(min(MD))
my_final %>% arrange(PATIENT_ID, SITE, VISIT_DATE)
my_final %>% arrange(PATIENT_ID, SITE, VISIT_DATE) %>% group_by(PATIENT_ID, SITE, VISIT_DATE)
my_final <- my_final %>% arrange(PATIENT_ID, SITE, VISIT_DATE)
write.csv(my_final, "031224 - AllVisits.csv")
library(tidyverse)
df <- read_csv("031224 - AllVisits.csv")
rm(list = ls())
rm(list = ls())
library(tidyverse)
df <- read_csv("031224 - AllVisits.csv")
# min 2 year FU, min 5 visits
df %>% filter(DIFF_TIME == 0 | DIFF_TIME >= 2) %>% group_by(PATIENT_ID, SITE) %>% mutate(FOLLOW_UPS = n_distinct(DIFF_TIME) - 1) %>% filter(FOLLOW_UPS >= 5) %>% distinct()
# min 2 year FU, min 5 visits
df %>% filter(DIFF_TIME == 0 | DIFF_TIME >= 2) %>% group_by(PATIENT_ID, SITE) %>% mutate(FOLLOW_UPS = n_distinct(DIFF_TIME) - 1) %>% filter(FOLLOW_UPS >= 5) %>% distinct() %>%  arrange(PATIENT_ID, SITE, VISIT_DATE, BASELINE)
# min 2 year FU, min 5 visits
df %>% filter(DIFF_TIME == 0 | DIFF_TIME >= 2) %>% group_by(PATIENT_ID, SITE) %>% mutate(FOLLOW_UPS = n_distinct(DIFF_TIME) - 1) %>% filter(FOLLOW_UPS >= 5) %>% distinct() %>% arrange(PATIENT_ID, SITE, VISIT_DATE, BASELINE) %>% select(-...1)
df %>% group_by(PATIENT_ID, SITE, BASELINE)
df %>% group_by(PATIENT_ID, SITE)
df %>% group_by(PATIENT_ID, SITE, BASELINE)
df %>% group_by(PATIENT_ID, SITE, BASELINE) %>% arrange(PATIENT_ID, SITE, BASELINE)
df %>% group_by(PATIENT_ID, SITE, BASELINE) %>% arrange(PATIENT_ID, SITE, BASELINE) %>% slice(1)
library(tidyverse)
df <- read_csv("~/Downloads/Glaucoma Research Volunteer/10:14 Paracentral Scotoma PD/ALL_VF_EXAMS_Pattern_Deviation__1990_2020.csv",
col_types = cols(VISIT_DATE = col_date(format = "%m/%d/%y")))
df <- df %>% filter(DISPLAY_NAME %in% c("SS-24-2 Thr", "SS242 Thr")) %>% distinct()
df$PSD_PROBABILITY <- as.numeric(df$PSD_PROBABILITY)
df$FALSE_POSITIVE_PERCENT <- as.numeric(df$FALSE_POSITIVE_PERCENT)
df$GHT <- as.numeric(df$GHT)
df$MD <- as.numeric(df$MD)
df <- df %>% filter(PSD_PROBABILITY >= 1)
df <- df %>% filter(FALSE_POSITIVE_PERCENT < 15)
df <- df %>% filter(GHT == 2 | GHT == 3)
df <- df %>% filter(MD > -6)
idx_include <- c(1:27, which(colnames(df) == "L_23"),which(colnames(df) == "L_24"), which(colnames(df) == "L_32"),which(colnames(df) == "L_33"))
df <- df[colnames(df)[idx_include]]
df$L_23 <- as.numeric(df$L_23)
df$L_24 <- as.numeric(df$L_24)
df$L_33 <- as.numeric(df$L_33)
df$L_32 <- as.numeric(df$L_32)
df <- df[(df$L_23 <= -5 | df$L_24 <= -5 | df$L_32 <= -5 | df$L_33 <= -5), ]
df <- df %>% group_by(PATIENT_ID, SITE, VISIT_DATE, `...7`) %>% slice(1)
df <- df %>% group_by(PATIENT_ID, SITE) %>% mutate(COUNTS = n_distinct(VISIT_DATE)) %>% filter(COUNTS > 1) %>% select(-COUNTS)
df <- df %>% arrange(PATIENT_ID, SITE, VISIT_DATE) %>% mutate(BASELINE = min(VISIT_DATE)) %>% mutate(DIFF_TIME = as.numeric(difftime(VISIT_DATE, BASELINE, units = "days")/365.25))
df <- df %>% group_by(PATIENT_ID, SITE, VISIT_DATE) %>% arrange(PATIENT_ID, SITE, VISIT_DATE, ...7) %>% slice(1) %>% distinct()
baseline <- df %>% filter(DIFF_TIME == 0)
df <- df %>% filter(DIFF_TIME != 0) %>% group_by(PATIENT_ID, SITE) %>% mutate(SECOND_DATE = min(DIFF_TIME)) %>% filter(DIFF_TIME == SECOND_DATE)
df <- df %>% select(-SECOND_DATE)
final <- rbind(baseline, df) %>% group_by(PATIENT_ID, SITE, VISIT_DATE) %>% arrange(PATIENT_ID, SITE, VISIT_DATE)
write.csv(final, "031224 - First2Visits.csv")
rm(list = ls())
df <- read_csv("~/Downloads/Glaucoma Research Volunteer/10:14 Paracentral Scotoma PD/ALL_VF_EXAMS_Pattern_Deviation__1990_2020.csv",
col_types = cols(VISIT_DATE = col_date(format = "%m/%d/%y")))
df <- df %>% filter(DISPLAY_NAME %in% c("SS-24-2 Thr", "SS242 Thr")) %>% distinct()
df$PSD_PROBABILITY <- as.numeric(df$PSD_PROBABILITY)
df$FALSE_POSITIVE_PERCENT <- as.numeric(df$FALSE_POSITIVE_PERCENT)
df$GHT <- as.numeric(df$GHT)
df$MD <- as.numeric(df$MD)
df <- df %>% filter(PSD_PROBABILITY >= 1)
df <- df %>% filter(FALSE_POSITIVE_PERCENT < 15)
df <- df %>% filter(GHT == 2 | GHT == 3)
idx_include <- c(1:27, which(colnames(df) == "L_23"),which(colnames(df) == "L_24"), which(colnames(df) == "L_32"),which(colnames(df) == "L_33"))
df <- df[colnames(df)[idx_include]]
df$L_23 <- as.numeric(df$L_23)
df$L_24 <- as.numeric(df$L_24)
df$L_33 <- as.numeric(df$L_33)
df$L_32 <- as.numeric(df$L_32)
df <- df[(df$L_23 <= -5 | df$L_24 <= -5 | df$L_32 <= -5 | df$L_33 <= -5), ]
df <- df %>% group_by(PATIENT_ID, SITE, VISIT_DATE, `...7`) %>% slice(1)
df <- df %>% group_by(PATIENT_ID, SITE) %>% mutate(COUNTS = n_distinct(VISIT_DATE)) %>% filter(COUNTS > 1) %>% select(-COUNTS)
df <- df %>% arrange(PATIENT_ID, SITE, VISIT_DATE) %>% mutate(BASELINE = min(VISIT_DATE)) %>% mutate(DIFF_TIME = as.numeric(difftime(VISIT_DATE, BASELINE, units = "days")/365.25))
df <- df %>% group_by(PATIENT_ID, SITE, VISIT_DATE) %>% arrange(PATIENT_ID, SITE, VISIT_DATE, ...7) %>% slice(1) %>% distinct()
df <- df %>% group_by(PATIENT_ID, SITE) %>% arrange(PATIENT_ID, SITE) %>% slice(-(1:2))
compare <- read_csv("~/Downloads/Glaucoma Research Volunteer/10:14 Paracentral Scotoma PD/031224 - First2Visits.csv")
colnames(compare)[-1] <- colnames(df)
compare <- compare %>% select(-1)
df$FALSE_NEGATIVE_PERCENT <- as.numeric(df$FALSE_NEGATIVE_PERCENT)
df$...23 <- as.numeric(df$...23)
df$PSD <- as.numeric(df$PSD)
df$VFI <- as.numeric(df$VFI)
df <- df %>% filter(PATIENT_ID %in% compare$PATIENT_ID)
use <- setdiff(df, compare) %>% distinct()
my_final <- rbind(compare, use) %>% distinct() %>% group_by(PATIENT_ID, SITE, VISIT_DATE) %>% arrange(PATIENT_ID, SITE, VISIT_DATE, ...7)
my_final <- my_final %>% group_by(PATIENT_ID, SITE, VISIT_DATE, ...7) %>% slice(1)
my_final <- my_final %>% arrange(PATIENT_ID, SITE, VISIT_DATE)
write.csv(my_final, "031224 - AllVisits.csv")
df <- df %>% filter(PATIENT_ID %in% compare$PATIENT_ID, BASELINE %in% compare$BASELINE)
use <- setdiff(df, compare) %>% distinct()
use
use %>% group_by(PATIENT_ID, SITE)
use %>% group_by(PATIENT_ID, SITE, BASELINE)
use %>% group_by(PATIENT_ID, SITE)
my_final <- rbind(compare, use) %>% distinct() %>% group_by(PATIENT_ID, SITE, VISIT_DATE) %>% arrange(PATIENT_ID, SITE, VISIT_DATE, ...7)
my_final <- my_final %>% group_by(PATIENT_ID, SITE, VISIT_DATE, ...7) %>% slice(1)
my_final <- my_final %>% arrange(PATIENT_ID, SITE, VISIT_DATE)
my_final
my_final %>% group_by(PATIENT_ID, SITE, VISIT_DATE)
write.csv(my_final, "031224 - AllVisits.csv")
rm(list = ls())
library(tidyverse)
df <- read_csv("031224 - AllVisits.csv")
# min 2 year FU, min 5 visits
df %>% filter(DIFF_TIME == 0 | DIFF_TIME >= 2) %>% group_by(PATIENT_ID, SITE) %>% mutate(FOLLOW_UPS = n_distinct(DIFF_TIME) - 1) %>% filter(FOLLOW_UPS >= 5) %>% distinct() %>% arrange(PATIENT_ID, SITE, VISIT_DATE, BASELINE) %>% select(-...1)
df %>% group_by(PATIENT_ID, SITE, BASELINE)
df %>% group_by(PATIENT_ID, SITE)
df %>% group_by(PATIENT_ID, SITE, BASELINE)
library(tidyverse)
df <- read_csv("~/Downloads/Glaucoma Research Volunteer/10:14 Paracentral Scotoma PD/ALL_VF_EXAMS_Pattern_Deviation__1990_2020.csv",
col_types = cols(VISIT_DATE = col_date(format = "%m/%d/%y")))
df <- df %>% filter(DISPLAY_NAME %in% c("SS-24-2 Thr", "SS242 Thr")) %>% distinct()
df$PSD_PROBABILITY <- as.numeric(df$PSD_PROBABILITY)
df$FALSE_POSITIVE_PERCENT <- as.numeric(df$FALSE_POSITIVE_PERCENT)
df$GHT <- as.numeric(df$GHT)
df$MD <- as.numeric(df$MD)
df <- df %>% filter(PSD_PROBABILITY >= 1)
df <- df %>% filter(FALSE_POSITIVE_PERCENT < 15)
df <- df %>% filter(GHT == 2 | GHT == 3)
df <- df %>% filter(MD > -6)
idx_include <- c(1:27, which(colnames(df) == "L_23"),which(colnames(df) == "L_24"), which(colnames(df) == "L_32"),which(colnames(df) == "L_33"))
df <- df[colnames(df)[idx_include]]
df$L_23 <- as.numeric(df$L_23)
df$L_24 <- as.numeric(df$L_24)
df$L_33 <- as.numeric(df$L_33)
df$L_32 <- as.numeric(df$L_32)
df <- df[(df$L_23 <= -5 | df$L_24 <= -5 | df$L_32 <= -5 | df$L_33 <= -5), ]
df <- df %>% group_by(PATIENT_ID, SITE, VISIT_DATE, `...7`) %>% slice(1)
df <- df %>% group_by(PATIENT_ID, SITE) %>% mutate(COUNTS = n_distinct(VISIT_DATE)) %>% filter(COUNTS > 1) %>% select(-COUNTS)
df <- df %>% arrange(PATIENT_ID, SITE, VISIT_DATE) %>% mutate(BASELINE = min(VISIT_DATE)) %>% mutate(DIFF_TIME = as.numeric(difftime(VISIT_DATE, BASELINE, units = "days")/365.25))
df <- df %>% group_by(PATIENT_ID, SITE, VISIT_DATE) %>% arrange(PATIENT_ID, SITE, VISIT_DATE, ...7) %>% slice(1) %>% distinct()
baseline <- df %>% filter(DIFF_TIME == 0)
df <- df %>% filter(DIFF_TIME != 0) %>% group_by(PATIENT_ID, SITE) %>% mutate(SECOND_DATE = min(DIFF_TIME)) %>% filter(DIFF_TIME == SECOND_DATE)
df <- df %>% select(-SECOND_DATE)
final <- rbind(baseline, df) %>% group_by(PATIENT_ID, SITE, VISIT_DATE) %>% arrange(PATIENT_ID, SITE, VISIT_DATE)
write.csv(final, "031224 - First2Visits.csv")
rm(list = ls())
df <- read_csv("~/Downloads/Glaucoma Research Volunteer/10:14 Paracentral Scotoma PD/ALL_VF_EXAMS_Pattern_Deviation__1990_2020.csv",
col_types = cols(VISIT_DATE = col_date(format = "%m/%d/%y")))
df <- df %>% filter(DISPLAY_NAME %in% c("SS-24-2 Thr", "SS242 Thr")) %>% distinct()
df$PSD_PROBABILITY <- as.numeric(df$PSD_PROBABILITY)
df$FALSE_POSITIVE_PERCENT <- as.numeric(df$FALSE_POSITIVE_PERCENT)
df$GHT <- as.numeric(df$GHT)
df$MD <- as.numeric(df$MD)
df <- df %>% filter(PSD_PROBABILITY >= 1)
df <- df %>% filter(FALSE_POSITIVE_PERCENT < 15)
df <- df %>% filter(GHT == 2 | GHT == 3)
idx_include <- c(1:27, which(colnames(df) == "L_23"),which(colnames(df) == "L_24"), which(colnames(df) == "L_32"),which(colnames(df) == "L_33"))
df <- df[colnames(df)[idx_include]]
df$L_23 <- as.numeric(df$L_23)
df$L_24 <- as.numeric(df$L_24)
df$L_33 <- as.numeric(df$L_33)
df$L_32 <- as.numeric(df$L_32)
df <- df[(df$L_23 <= -5 | df$L_24 <= -5 | df$L_32 <= -5 | df$L_33 <= -5), ]
df <- df %>% group_by(PATIENT_ID, SITE, VISIT_DATE, `...7`) %>% slice(1)
df <- df %>% group_by(PATIENT_ID, SITE) %>% mutate(COUNTS = n_distinct(VISIT_DATE)) %>% filter(COUNTS > 1) %>% select(-COUNTS)
df <- df %>% arrange(PATIENT_ID, SITE, VISIT_DATE) %>% mutate(BASELINE = min(VISIT_DATE)) %>% mutate(DIFF_TIME = as.numeric(difftime(VISIT_DATE, BASELINE, units = "days")/365.25))
df <- df %>% group_by(PATIENT_ID, SITE, VISIT_DATE) %>% arrange(PATIENT_ID, SITE, VISIT_DATE, ...7) %>% slice(1) %>% distinct()
df <- df %>% group_by(PATIENT_ID, SITE) %>% arrange(PATIENT_ID, SITE) %>% slice(-(1:2))
compare <- read_csv("~/Downloads/Glaucoma Research Volunteer/10:14 Paracentral Scotoma PD/031224 - First2Visits.csv")
colnames(compare)[-1] <- colnames(df)
compare <- compare %>% select(-1)
df$FALSE_NEGATIVE_PERCENT <- as.numeric(df$FALSE_NEGATIVE_PERCENT)
df$...23 <- as.numeric(df$...23)
df$PSD <- as.numeric(df$PSD)
df$VFI <- as.numeric(df$VFI)
df <- df %>% filter(PATIENT_ID %in% compare$PATIENT_ID, BASELINE %in% compare$BASELINE)
use <- setdiff(df, compare) %>% distinct()
my_final <- rbind(compare, use) %>% distinct() %>% group_by(PATIENT_ID, SITE, VISIT_DATE) %>% arrange(PATIENT_ID, SITE, VISIT_DATE, ...7)
my_final <- my_final %>% group_by(PATIENT_ID, SITE, VISIT_DATE, ...7) %>% slice(1)
my_final <- my_final %>% arrange(PATIENT_ID, SITE, VISIT_DATE)
my_final %>% group_by(PATIENT_ID, SITE, BASELINE)
my_final %>% group_by(PATIENT_ID, SITE)
my_final %>% group_by(PATIENT_ID, SITE) %>% arrange(PATIENT_ID, SITE, BASELINE)
my_final %>% group_by(PATIENT_ID, SITE) %>% arrange(PATIENT_ID, SITE, BASELINE) %>% slice(1)
my_final %>% group_by()
my_final %>% group_by(PATIENT_ID, SITE, BASELINE)
my_final %>% group_by(PATIENT_ID, SITE) %>% summarize(n_distinct(BASELINE))
my_final %>% group_by(PATIENT_ID, SITE) %>% summarize(MULT_BASELINE = n_distinct(BASELINE)) %>% filter(MULT_BASELINE > 1)
my_final %>% group_by(PATIENT_ID, SITE) %>% mutate(MULT_BASELINE = n_distinct(BASELINE)) %>% filter(MULT_BASELINE > 1)
my_final %>% group_by(PATIENT_ID, SITE) %>% mutate(MULT_BASELINE = n_distinct(BASELINE)) %>% filter(MULT_BASELINE == 1)
keep <- my_final %>% group_by(PATIENT_ID, SITE) %>% mutate(MULT_BASELINE = n_distinct(BASELINE)) %>% filter(MULT_BASELINE == 1)
my_final %>% group_by(PATIENT_ID, SITE) %>% mutate(MULT_BASELINE = n_distinct(BASELINE)) %>% filter(MULT_BASELINE != 1)
fix <- my_final %>% group_by(PATIENT_ID, SITE) %>% mutate(MULT_BASELINE = n_distinct(BASELINE)) %>% filter(MULT_BASELINE != 1)
fix
fix %>% ungroup()
fix %>% ungroup() %>% group_by(PATIENT_ID, SITE) %>% summarize(min(VISIT_DATE))
fix %>% ungroup() %>% group_by(PATIENT_ID, SITE) %>% summarize(BASELINE = min(VISIT_DATE))
fix %>% ungroup() %>% group_by(PATIENT_ID, SITE) %>% mutate(BASELINE = min(VISIT_DATE)) %>%
```
fix %>% ungroup() %>% group_by(PATIENT_ID, SITE) %>% mutate(BASELINE = min(VISIT_DATE))
fix %>% ungroup() %>% group_by(PATIENT_ID, SITE) %>% mutate(BASELINE = min(VISIT_DATE)) %>% mutate(DIFF_TIME = as.numeric(abs(difftime(VISIT_DATE, BASELINE))/365.25))
fix %>% ungroup() %>% group_by(PATIENT_ID, SITE) %>% mutate(BASELINE = min(VISIT_DATE)) %>% mutate(DIFF_TIME = as.numeric(abs(difftime(VISIT_DATE, BASELINE)))/365.25)
fix %>% ungroup() %>% group_by(PATIENT_ID, SITE) %>% mutate(BASELINE = min(VISIT_DATE)) %>% mutate(DIFF_TIME = as.numeric(abs(difftime(VISIT_DATE, BASELINE, units = "days")))/365.25)
fix %>% ungroup() %>% group_by(PATIENT_ID, SITE) %>% mutate(BASELINE = min(VISIT_DATE)) %>% mutate(DIFF_TIME = as.numeric(abs(difftime(VISIT_DATE, BASELINE, units = "days")))/365.25) %>% mutate(MULT_BASELINE = n_distinct(BASELINE))
fix %>% ungroup() %>% group_by(PATIENT_ID, SITE) %>% mutate(BASELINE = min(VISIT_DATE)) %>% mutate(DIFF_TIME = as.numeric(abs(difftime(VISIT_DATE, BASELINE, units = "days")))/365.25) %>% mutate(MULT_BASELINE = n_distinct(BASELINE)) %>% filter(MULT_BASELINE != 1)
fix %>% ungroup() %>% group_by(PATIENT_ID, SITE) %>% mutate(BASELINE = min(VISIT_DATE)) %>% mutate(DIFF_TIME = as.numeric(abs(difftime(VISIT_DATE, BASELINE, units = "days")))/365.25) %>% mutate(MULT_BASELINE = n_distinct(BASELINE)) %>% filter(MULT_BASELINE != 1)
fix %>% ungroup() %>% group_by(PATIENT_ID, SITE) %>% mutate(BASELINE = min(VISIT_DATE)) %>% mutate(DIFF_TIME = as.numeric(abs(difftime(VISIT_DATE, BASELINE, units = "days")))/365.25) %>% mutate(MULT_BASELINE = n_distinct(BASELINE))
fix %>% ungroup() %>% group_by(PATIENT_ID, SITE) %>% mutate(BASELINE = min(VISIT_DATE)) %>% mutate(DIFF_TIME = as.numeric(abs(difftime(VISIT_DATE, BASELINE, units = "days")))/365.25) %>% mutate(MULT_BASELINE = n_distinct(BASELINE))
fix <- fix %>% ungroup() %>% group_by(PATIENT_ID, SITE) %>% mutate(BASELINE = min(VISIT_DATE)) %>% mutate(DIFF_TIME = as.numeric(abs(difftime(VISIT_DATE, BASELINE, units = "days")))/365.25) %>% mutate(MULT_BASELINE = n_distinct(BASELINE))
rbind(keep, fix)
rbind(keep, fix) %>% group_by(PATIENT_ID, SITE)
rbind(keep, fix) %>% group_by(PATIENT_ID, SITE, VISIT_DATE, ...7)
rbind(keep, fix) %>% group_by(PATIENT_ID, SITE, VISIT_DATE)
rbind(keep, fix) %>% group_by(PATIENT_ID, SITE, VISIT_DATE) %>% arrange(PATIENT_ID, SITE, VISIT_DATE)
rbind(keep, fix) %>% group_by(PATIENT_ID, SITE, VISIT_DATE) %>% arrange(PATIENT_ID, SITE, VISIT_DATE) %>% select(-MULT_BASELINE)
my_final <- rbind(keep, fix) %>% group_by(PATIENT_ID, SITE, VISIT_DATE) %>% arrange(PATIENT_ID, SITE, VISIT_DATE) %>% select(-MULT_BASELINE)
write.csv(my_final, "031224 - AllVisits.csv")
rm(list = ls())
library(tidyverse)
df <- read_csv("031224 - AllVisits.csv")
df %>% group_by(PATIENT_ID, SITE, BASELINE)
df %>% group_by(PATIENT_ID, SITE)
# min 2 year FU, min 5 visits
df %>% filter(DIFF_TIME == 0 | DIFF_TIME >= 2) %>% group_by(PATIENT_ID, SITE) %>% mutate(FOLLOW_UPS = n_distinct(DIFF_TIME) - 1) %>% filter(FOLLOW_UPS >= 5) %>% distinct() %>% arrange(PATIENT_ID, SITE, VISIT_DATE, BASELINE) %>% select(-...1)
# min 2 year FU, min 5 visits
df %>% filter(DIFF_TIME == 0 | DIFF_TIME >= 2) %>% group_by(PATIENT_ID, SITE) %>% mutate(FOLLOW_UPS = n_distinct(DIFF_TIME) - 1) %>% filter(FOLLOW_UPS >= 5) %>% distinct() %>% arrange(PATIENT_ID, SITE, VISIT_DATE) %>% select(-...1)
# min 2 year FU, min 5 visits
df %>% filter(DIFF_TIME == 0 | DIFF_TIME >= 2) %>% group_by(PATIENT_ID, SITE) %>% mutate(FOLLOW_UPS = n_distinct(DIFF_TIME) - 1) %>% filter(FOLLOW_UPS >= 5) %>% distinct() %>% arrange(PATIENT_ID, SITE, VISIT_DATE) %>% select(-...1)
# min 2 year FU, min 5 visits
f25 <- df %>% filter(DIFF_TIME == 0 | DIFF_TIME >= 2) %>% group_by(PATIENT_ID, SITE) %>% mutate(FOLLOW_UPS = n_distinct(DIFF_TIME) - 1) %>% filter(FOLLOW_UPS >= 5) %>% distinct() %>% arrange(PATIENT_ID, SITE, VISIT_DATE) %>% select(-...1)
f25
f25 %>% group_by(PATIENT_ID, SITE)
f25 %>% group_by(PATIENT_ID) # 840 eyes
# 650 patients, 840 eyes
write.csv(f25, "031324 - AllVisits_2_5FU.csv")
f55 <- df %>% filter(DIFF_TIME == 0 | DIFF_TIME >= 5) %>% group_by(PATIENT_ID, SITE) %>% mutate(FOLLOW_UPS = n_distinct(DIFF_TIME) - 1) %>% filter(FOLLOW_UPS >= 5) %>% distinct() %>% arrange(PATIENT_ID, SITE, VISIT_DATE) %>% select(-...1)
f55
f55 %>% group_by(PATIENT_ID) # 528 eyes
# 409 patients, 528 eyes
write.csv(f55, "031324 - AllVisits_5_5FU.csv")
df
rm(list = ls())
library(tidyverse)
df <- read_csv("031224 - AllVisits.csv")
# min 2 year FU, min 5 visits
f25 <- df %>% filter(DIFF_TIME == 0 | DIFF_TIME <= 2) %>% group_by(PATIENT_ID, SITE) %>% mutate(FOLLOW_UPS = n_distinct(DIFF_TIME) - 1) %>% filter(FOLLOW_UPS >= 5) %>% distinct() %>% arrange(PATIENT_ID, SITE, VISIT_DATE) %>% select(-...1)
# 650 patients, 840 eyes
write.csv(f25, "031324 - AllVisits_2_5FU.csv")
# min 5 year FU, min 5 visits
f55 <- df %>% filter(DIFF_TIME == 0 | DIFF_TIME <= 5) %>% group_by(PATIENT_ID, SITE) %>% mutate(FOLLOW_UPS = n_distinct(DIFF_TIME) - 1) %>% filter(FOLLOW_UPS >= 5) %>% distinct() %>% arrange(PATIENT_ID, SITE, VISIT_DATE) %>% select(-...1)
write.csv(f55, "031324 - AllVisits_5_5FU.csv")
f25 %>% group_by(PATIENT_ID)# 650 patients, 840 eyes
f25 %>% group_by(PATIENT_ID, SITE)# 13 patients, 840 eyes
f55 %>% group_by(PATIENT_ID, SITE)
f55 %>% group_by(PATIENT_ID)
f55 %>% group_by(PATIENT_ID, SITE)
write.csv(f55, "031324 - Min_5_5FU.csv")
write.csv(f25, "031324 - Min_2_5FU.csv")
setwd("/Users/lianzou/Downloads/Glaucoma Research Volunteer/10:14 Paracentral Scotoma PD")
rm(list = ls())
library(tidyverse)
df <- read_csv("031224 - AllVisits.csv")
# min 2 year FU, min 5 visits
df
# min 2 year FU, min 5 visits
df %>% group_by(PATIENT_ID, SITE)
# min 2 year FU, min 5 visits
df %>% group_by(PATIENT_ID, SITE) %>% summarize(max(VISIT_DATE))
# min 2 year FU, min 5 visits
df %>% group_by(PATIENT_ID, SITE) %>% summarize(FINAL_DATE = max(VISIT_DATE))
# min 2 year FU, min 5 visits
df %>% group_by(PATIENT_ID, SITE) %>% summarize(FINAL_DATE = max(VISIT_DATE)) %>% summarize(DIFF_TIME = difftime(FINAL_DATE, BASELINE))
# min 2 year FU, min 5 visits
df %>% group_by(PATIENT_ID, SITE) %>% summarize(FINAL_DATE = max(VISIT_DATE)) %>% summarize(INTERVAL = difftime(FINAL_DATE, BASELINE))
# min 2 year FU, min 5 visits
df
# min 2 year FU, min 5 visits
df <- df %>% select(-DIFF_TIME)
# min 2 year FU, min 5 visits
df <- df %>% select(-DIFF_TIME)
df %>% group_by(PATIENT_ID, SITE) %>% summarize(FINAL_DATE = max(VISIT_DATE)) %>% summarize(DIFF_TIME = difftime(FINAL_DATE, BASELINE))
df %>% group_by(PATIENT_ID, SITE) %>% summarize(FINAL_DATE = max(VISIT_DATE)) %>% mutate(DIFF_TIME = difftime(FINAL_DATE, BASELINE))
df %>% group_by(PATIENT_ID, SITE) %>% summarize(FINAL_DATE = max(VISIT_DATE))
df %>% group_by(PATIENT_ID, SITE) %>% mutate(FINAL_DATE = max(VISIT_DATE))
df %>% group_by(PATIENT_ID, SITE) %>% mutate(FINAL_DATE = max(VISIT_DATE)) %>% mutate(DIFF_TIME = as.numeric(abs(difftime(BASELINE, FINAL_DATE))))
df %>% group_by(PATIENT_ID, SITE) %>% mutate(FINAL_DATE = max(VISIT_DATE)) %>% mutate(DIFF_TIME = as.numeric(abs(difftime(BASELINE, FINAL_DATE, units = "days")/365.25)))
df <- df %>% group_by(PATIENT_ID, SITE) %>% mutate(FINAL_DATE = max(VISIT_DATE)) %>% mutate(DIFF_TIME = as.numeric(abs(difftime(BASELINE, FINAL_DATE, units = "days")/365.25)))
df %>% filter(DIFF_TIME == 0 | DIFF_TIME >= 2) %>% group_by(PATIENT_ID, SITE) %>% mutate(FOLLOW_UPS = n_distinct(VISIT_DATE) - 1) %>% filter(FOLLOW_UPS >= 5) %>% distinct() %>% arrange(PATIENT_ID, SITE, VISIT_DATE) %>% select(-...1)
f25 <- df %>% filter(DIFF_TIME == 0 | DIFF_TIME >= 2) %>% group_by(PATIENT_ID, SITE) %>% mutate(FOLLOW_UPS = n_distinct(VISIT_DATE) - 1) %>% filter(FOLLOW_UPS >= 5) %>% distinct() %>% arrange(PATIENT_ID, SITE, VISIT_DATE) %>% select(-...1)
write.csv(f25, "031424 - 2yr_5FU.csv")
f25
f25 %>% group_by(PATIENT_ID)
f25 %>% group_by(PATIENT_ID, SITE) # 836 patients,
# min 5 year FU, min 5 visits
f55 <- df %>% filter(DIFF_TIME == 0 | DIFF_TIME >= 5) %>% group_by(PATIENT_ID, SITE) %>% mutate(FOLLOW_UPS = n_distinct(VISIT_DATE) - 1) %>% filter(FOLLOW_UPS >= 5) %>% distinct() %>% arrange(PATIENT_ID, SITE, VISIT_DATE) %>% select(-...1)
f55 %>% group_by(PATIENT_ID, SITE) # 470 patients, 573 eyes
f55 %>% group_by(PATIENT_ID) # 470 patients, 935 eyes
# 731 patients, 935 eyes
write.csv(f55, "031424 - 5yr_5FU.csv")
