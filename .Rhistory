df %>% filter(DIFF_TIME == 0 | DIFF_TIME >= 4) %>% group_by(PATIENT_ID, SITE) %>% mutate(FOLLOW_UPS = n_distinct(DIFF_TIME) - 1) %>% filter(FOLLOW_UPS >= 2) %>% distinct() %>% arrange(PATIENT_ID, SITE)
filtered_final_2 <- df %>% filter(DIFF_TIME == 0 | DIFF_TIME >= 4) %>% group_by(PATIENT_ID, SITE) %>% mutate(FOLLOW_UPS = n_distinct(DIFF_TIME) - 1) %>% filter(FOLLOW_UPS >= 2) %>% distinct()
write.csv(filtered_final_2, "031224 - AllVisits_2FU.csv")
df %>% filter(DIFF_TIME == 0 | DIFF_TIME >= 2) %>% group_by(PATIENT_ID, SITE) %>% mutate(FOLLOW_UPS = n_distinct(DIFF_TIME) - 1) %>% filter(FOLLOW_UPS >= 4) %>% distinct()
df %>% filter(DIFF_TIME == 0 | DIFF_TIME >= 2) %>% group_by(PATIENT_ID, SITE) %>% mutate(FOLLOW_UPS = n_distinct(DIFF_TIME) - 1) %>% filter(FOLLOW_UPS >= 4) %>% distinct() %>% group_by(PATIENT_ID)
df %>% filter(DIFF_TIME == 0 | DIFF_TIME >= 2) %>% group_by(PATIENT_ID, SITE) %>% mutate(FOLLOW_UPS = n_distinct(DIFF_TIME) - 1) %>% filter(FOLLOW_UPS >= 4) %>% distinct() %>% group_by(PATIENT_ID, SITE)
write.csv(filtered_final, "031224 - AllVisits_4FU.csv")
filtered_final <- df %>% filter(DIFF_TIME == 0 | DIFF_TIME >= 2) %>% group_by(PATIENT_ID, SITE) %>% mutate(FOLLOW_UPS = n_distinct(DIFF_TIME) - 1) %>% filter(FOLLOW_UPS >= 4) %>% distinct()
write.csv(filtered_final, "031224 - AllVisits_4FU.csv")
library(tidyverse)
df <- read_tsv(water_use)
df <- read_tsv("water_use")
setwd("/Users/lianzou/Downloads/DH101")
df <- read_tsv("water_use")
df
df[312:719, ]
df <- df[312:719, ]
df %>% separate(sep = "\t")
df
df %>% separate("Content-type: text/plain", sep = "\t")
df
df[1, ]
df <- read_tsv("water_use", sep = "\t")
rm(list = ls())
library(tidyverse)
df <- read_csv(water_use)
df <- read_csv("water_use")
df
df <- read_tsv("water_use")
df
df[312:719, ]
df <- df[312:719, ]
df
colnames(df) <- df[1, ]
df
df[-1, ]
df[-(1:2), ]
df <- df[-(1:2), ]
df
colnames(df)
strsplit(colnames(df), "\t")
colnames(df) <- strsplit(colnames(df), "\t")
df
df %>% separate("\t")
df
colnames(df)
strsplit(colnames(df), "\t")
library(tidyverse)
df <- read_tsv("water_use")
df <- df[312:719, ]
colnames(df) <- df[1, ]
df <- df[-(1:2), ]
df
apply(df, 1, str_split(., "\t")
apply(df, 1, str_split(., "\t"))
df
df[1, ]
str_split(df[1, ], "\t")
str_split(df, "\t")
str_split(df[1, ], "\t")
split_df <- apply(df, 1, function(row) str_split(row, "\t"))
split_df
split_df
as.data.frame(split_df)
t(as.data.frame(split_df))
as.data.frame(split_df)
library(tidyverse)
df <- read_tsv("water_use")
setwd("/Users/lianzou/Downloads/DH101")
library(tidyverse)
df <- read_tsv("water_use")
setwd("/Users/lianzou/Downloads/DH101")
library(tidyverse)
df <- read_tsv("water_use")
df <- df[312:719, ]
colnames(df) <- df[1, ]
df <- df[-(1:2), ]
df
colnames(df)
str_split(colnames(df), "\t"
str_split(colnames(df), "\t")
strsplit(colnames(df), "\t")
unlist(strsplit(colnames(df), "\t"))
colnames <- unlist(strsplit(colnames(df), "\t"))
df
df %>% separate(., into = colnames, sep = "\t")
df %>% separate(into = colnames, sep = "\t")
colnames(df)
colnames(df) <- "test"
df %>% separate(test, into = colnames, sep = "\t")
df <- df %>% separate(test, into = colnames, sep = "\t")
df
df
df %>% select(county_nm, year, `Total Population total population of area, in thousands`)
colnames(df)
df %>% select(county_nm, year, "Total Population total population of area, in thousands", "Public Supply deliveries to domestic, in Mgal/d", "Public Supply deliveries to commercial, in Mgal/d", "Public Supply deliveries to industrial, in Mgal/d", "Public Supply deliveries to thermoelectric, in Mgal/d", "Public Supply total deliveries, in Mgal/d")
df <- df %>% select(county_nm, year, "Total Population total population of area, in thousands", "Public Supply deliveries to domestic, in Mgal/d", "Public Supply deliveries to commercial, in Mgal/d", "Public Supply deliveries to industrial, in Mgal/d", "Public Supply deliveries to thermoelectric, in Mgal/d", "Public Supply total deliveries, in Mgal/d")
df
df %>% filter(county_nm == "Los Angeles County")
df
df$`Total Population total population of area, in thousands` <- as.numeric(df$`Total Population total population of area, in thousands`)
df$`Public Supply deliveries to commercial, in Mgal/d` <- as.numeric(df$`Public Supply deliveries to commercial, in Mgal/d`)
df$`Public Supply deliveries to domestic, in Mgal/d` <- as.numeric(df$`Public Supply deliveries to domestic, in Mgal/d`)
df$`Public Supply deliveries to industrial, in Mgal/d` <- as.numeric(df$`Public Supply deliveries to industrial, in Mgal/d`)
df$`Public Supply deliveries to thermoelectric, in Mgal/d` <- as.numeric(df$`Public Supply deliveries to thermoelectric, in Mgal/d`)
df$`Public Supply total deliveries, in Mgal/d` <- as.numeric(df$`Public Supply total deliveries, in Mgal/d`)
df
df %>% drop_na()
df <- df %>% drop_na()
df
df %>% group_by(year)
library(tidyverse)
df <- read_tsv("water_use")
df <- df[312:719, ]
colnames(df) <- df[1, ]
df <- df[-(1:2), ]
colnames <- unlist(strsplit(colnames(df), "\t"))
colnames(df) <- "test"
df <- df %>% separate(test, into = colnames, sep = "\t")
colnames(df)
df <- df %>% select(county_nm, year, "Total Population total population of area, in thousands", "Public Supply deliveries to domestic, in Mgal/d", "Public Supply deliveries to commercial, in Mgal/d", "Public Supply deliveries to industrial, in Mgal/d", "Public Supply deliveries to thermoelectric, in Mgal/d", "Public Supply total deliveries, in Mgal/d")
df$`Total Population total population of area, in thousands` <- as.numeric(df$`Total Population total population of area, in thousands`)
df$`Public Supply deliveries to commercial, in Mgal/d` <- as.numeric(df$`Public Supply deliveries to commercial, in Mgal/d`)
df$`Public Supply deliveries to domestic, in Mgal/d` <- as.numeric(df$`Public Supply deliveries to domestic, in Mgal/d`)
df$`Public Supply deliveries to industrial, in Mgal/d` <- as.numeric(df$`Public Supply deliveries to industrial, in Mgal/d`)
df$`Public Supply deliveries to thermoelectric, in Mgal/d` <- as.numeric(df$`Public Supply deliveries to thermoelectric, in Mgal/d`)
df$`Public Supply total deliveries, in Mgal/d` <- as.numeric(df$`Public Supply total deliveries, in Mgal/d`)
df %>% group_by(year)
df %>% group_by(year) %>% summarize(DOMESTIC = `Public Supply deliveries to domestic, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`)
df %>% group_by(year) %>% summarize(DOMESTIC = `Public Supply deliveries to domestic, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`) %>% summarize(mean(DOMESTIC))
df %>% group_by(year) %>% summarize(DOMESTIC = `Public Supply deliveries to domestic, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`) %>% summarize(mean(DOMESTIC, na.rm = TRUE))
df %>% group_by(year) %>% summarize(DOMESTIC = `Public Supply deliveries to domestic, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`) %>% summarize(MEAN_DOMESTIC = mean(DOMESTIC, na.rm = TRUE))
df %>% group_by(year) %>% mutate(DOMESTIC = `Public Supply deliveries to domestic, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`) %>% summarize(MEAN_DOMESTIC = mean(DOMESTIC, na.rm = TRUE))
df %>% group_by(year) %>% mutate(DOMESTIC = `Public Supply deliveries to domestic, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`) %>% mutate(MEAN_DOMESTIC = mean(DOMESTIC, na.rm = TRUE))
df %>% group_by(year) %>% mutate(DOMESTIC = `Public Supply deliveries to domestic, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`) %>% mutate(MEAN_DOMESTIC = mean(DOMESTIC, na.rm = TRUE))
%>% mutate(INDUSTRIAL = `Public Supply deliveries to industrial, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`) %>% mutate(MEAN_INDUSTRIAL = mean(INDUSTRIAL, na.rm = TRUE))
df %>% group_by(year) %>% mutate(DOMESTIC = `Public Supply deliveries to domestic, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`) %>% mutate(MEAN_DOMESTIC = mean(DOMESTIC, na.rm = TRUE)) %>% mutate(INDUSTRIAL = `Public Supply deliveries to industrial, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`) %>% mutate(MEAN_INDUSTRIAL = mean(INDUSTRIAL, na.rm = TRUE))
df %>% group_by(year) %>% summarize(DOMESTIC = `Public Supply deliveries to domestic, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`) %>% summarize(MEAN_DOMESTIC = mean(DOMESTIC, na.rm = TRUE)) %>% summarize(INDUSTRIAL = `Public Supply deliveries to industrial, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`) %>% summarize(MEAN_INDUSTRIAL = mean(INDUSTRIAL, na.rm = TRUE))
df %>% group_by(year) %>% summarize(DOMESTIC = `Public Supply deliveries to domestic, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`) %>% summarize(MEAN_DOMESTIC = mean(DOMESTIC, na.rm = TRUE))
%>% summarize(INDUSTRIAL = `Public Supply deliveries to industrial, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`) %>% summarize(MEAN_INDUSTRIAL = mean(INDUSTRIAL, na.rm = TRUE))
df %>% group_by(year) %>% mutate(DOMESTIC = `Public Supply deliveries to domestic, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`) %>% mutate(MEAN_DOMESTIC = mean(DOMESTIC, na.rm = TRUE)) %>% mutate(INDUSTRIAL = `Public Supply deliveries to industrial, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`) %>% mutate(MEAN_INDUSTRIAL = mean(INDUSTRIAL, na.rm = TRUE))
df %>% group_by(year) %>% mutate(DOMESTIC = `Public Supply deliveries to domestic, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`) %>% mutate(MEAN_DOMESTIC = mean(DOMESTIC, na.rm = TRUE)) %>% mutate(INDUSTRIAL = `Public Supply deliveries to industrial, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`) %>% mutate(MEAN_INDUSTRIAL = mean(INDUSTRIAL, na.rm = TRUE)) %>% mutate(THERMOELECTRIC = `Public Supply deliveries to thermoelectric, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`) %>% mutate(MEAN_THERMOELECTRIC = mean(THERMOELECTRIC, na.rm = TRUE))
df %>% group_by(year) %>% mutate(DOMESTIC = `Public Supply deliveries to domestic, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`) %>% mutate(MEAN_DOMESTIC = mean(DOMESTIC, na.rm = TRUE)) %>% mutate(INDUSTRIAL = `Public Supply deliveries to industrial, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`) %>% mutate(MEAN_INDUSTRIAL = mean(INDUSTRIAL, na.rm = TRUE)) %>% mutate(THERMOELECTRIC = `Public Supply deliveries to thermoelectric, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`) %>% mutate(MEAN_THERMOELECTRIC = mean(THERMOELECTRIC, na.rm = TRUE)) %>% mutate(COMMERCIAL = `Public Supply deliveries to commercial, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`) %>% mutate(MEAN_COMMERCIAL = mean(COMMERCIAL, na.rm = TRUE))
df <- df %>% group_by(year) %>% mutate(DOMESTIC = `Public Supply deliveries to domestic, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`) %>% mutate(MEAN_DOMESTIC = mean(DOMESTIC, na.rm = TRUE)) %>% mutate(INDUSTRIAL = `Public Supply deliveries to industrial, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`) %>% mutate(MEAN_INDUSTRIAL = mean(INDUSTRIAL, na.rm = TRUE)) %>% mutate(THERMOELECTRIC = `Public Supply deliveries to thermoelectric, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`) %>% mutate(MEAN_THERMOELECTRIC = mean(THERMOELECTRIC, na.rm = TRUE)) %>% mutate(COMMERCIAL = `Public Supply deliveries to commercial, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`) %>% mutate(MEAN_COMMERCIAL = mean(COMMERCIAL, na.rm = TRUE))
df
df %>% select(-(3:8))
df %>% select(-(3:8)) %>% drop_na()
df %>% select(-(3:8))
df %>% select(-(3:8)) %>% drop_na()
df <- df %>% select(-(3:8)) %>% drop_na()
df
df[, 310]
df[, 3:10]
df[, 3:10] * 100
df[, 3:10] <- df[, 3:10] * 100
df
df %>% group_by(year)
df %>% group_by(year) %>% summarize(MEAN_DOMESTIC)
df %>% group_by(year) %>% summarize(mean(MEAN_DOMESTIC))
df
df %>% group_by(county_nm, year)
df %>% group_by(county_nm)
df %>% group_by(year)
df %>% select(county_nm, year, MEAN_COMMERCIAL, MEAN_INDUSTRIAL, MEAN_THERMOELECTRIC, MEAN_DOMESTIC)
df <- df %>% select(county_nm, year, MEAN_COMMERCIAL, MEAN_INDUSTRIAL, MEAN_THERMOELECTRIC, MEAN_DOMESTIC)
df
rowSums(df[, 3:6])
df
library(reshape2)
data_melted <- melt(df, id.vars=c("county_nm", "year"), variable.name="category", value.name="mean_value")
ggplot(data_melted, aes(x=year, y=mean_value, color=category, group=interaction(county_nm,category))) +
geom_line() +
geom_point() +
facet_wrap(~ county_nm, scales="free_y") +
theme_minimal() +
labs(title="Mean Values by Category over Years", y="Mean Value", x="Year") +
theme(axis.text.x=element_text(angle=45, hjust=1))
ggplot(data_melted, aes(x=as.factor(year), y=mean_value, group=1)) +
geom_line(size=1) +
geom_point(size=3) +
theme_minimal(base_size = 14) + # Increase the base text size
labs(title="Mean Commercial Value over Years", y="Mean Commercial Value", x="Year") +
theme(axis.text.x=element_text(angle=45, hjust=1)) +
ylim(0, max(alameda_data$mean_value) * 1.1) # Adjust Y-axis limits
ggplot(data_melted, aes(x=as.factor(year), y=mean_value, group=1)) +
geom_line(size=1) +
geom_point(size=3) +
theme_minimal(base_size = 14) + # Increase the base text size
labs(title="Mean Commercial Value over Years", y="Mean Commercial Value", x="Year") +
theme(axis.text.x=element_text(angle=45, hjust=1)) +
ylim(0, max(data_melted$mean_value) * 1.1) # Adjust Y-axis limits
ggplot(data_melted, aes(x=year, y=mean_value, color=category, group=interaction(county_nm,category))) +
geom_line() +
geom_point() +
facet_wrap(~ county_nm, scales="free_y") +
theme_minimal() +
labs(title="Mean Values by Category over Years", y="Mean Value", x="Year") +
theme(axis.text.x=element_text(angle=45, hjust=1))
data_melted
data_melted %>% filter(county_nm == c("Los Angeles County" | "Orange County" | "Sacramento County" | "San Diego County"))
data_melted %>% filter(county_nm %in% c("Los Angeles County", "Orange County", "Sacramento County", "San Diego County"))
data_melted <- data_melted %>% filter(county_nm %in% c("Los Angeles County", "Orange County", "Sacramento County", "San Diego County"))
ggplot(data_melted, aes(x=year, y=mean_value, color=category, group=interaction(county_nm,category))) +
geom_line() +
geom_point() +
facet_wrap(~ county_nm, scales="free_y") +
theme_minimal() +
labs(title="Mean Values by Category over Years", y="Mean Value", x="Year") +
theme(axis.text.x=element_text(angle=45, hjust=1))
data_melted
library(tidyverse)
df <- read_tsv("water_use")
df <- df[312:719, ]
colnames(df) <- df[1, ]
df <- df[-(1:2), ]
colnames <- unlist(strsplit(colnames(df), "\t"))
colnames(df) <- "test"
df <- df %>% separate(test, into = colnames, sep = "\t")
colnames(df)
df <- df %>% select(county_nm, year, "Total Population total population of area, in thousands", "Public Supply deliveries to domestic, in Mgal/d", "Public Supply deliveries to commercial, in Mgal/d", "Public Supply deliveries to industrial, in Mgal/d", "Public Supply deliveries to thermoelectric, in Mgal/d", "Public Supply total deliveries, in Mgal/d")
df$`Total Population total population of area, in thousands` <- as.numeric(df$`Total Population total population of area, in thousands`)
df$`Public Supply deliveries to commercial, in Mgal/d` <- as.numeric(df$`Public Supply deliveries to commercial, in Mgal/d`)
df$`Public Supply deliveries to domestic, in Mgal/d` <- as.numeric(df$`Public Supply deliveries to domestic, in Mgal/d`)
df$`Public Supply deliveries to industrial, in Mgal/d` <- as.numeric(df$`Public Supply deliveries to industrial, in Mgal/d`)
df$`Public Supply deliveries to thermoelectric, in Mgal/d` <- as.numeric(df$`Public Supply deliveries to thermoelectric, in Mgal/d`)
df$`Public Supply total deliveries, in Mgal/d` <- as.numeric(df$`Public Supply total deliveries, in Mgal/d`)
df <- df %>% group_by(year) %>% mutate(DOMESTIC = `Public Supply deliveries to domestic, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`) %>% mutate(MEAN_DOMESTIC = mean(DOMESTIC, na.rm = TRUE)) %>% mutate(INDUSTRIAL = `Public Supply deliveries to industrial, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`) %>% mutate(MEAN_INDUSTRIAL = mean(INDUSTRIAL, na.rm = TRUE)) %>% mutate(THERMOELECTRIC = `Public Supply deliveries to thermoelectric, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`) %>% mutate(MEAN_THERMOELECTRIC = mean(THERMOELECTRIC, na.rm = TRUE)) %>% mutate(COMMERCIAL = `Public Supply deliveries to commercial, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`) %>% mutate(MEAN_COMMERCIAL = mean(COMMERCIAL, na.rm = TRUE))
df
df %>% filter(county_nm %in% c("Los Angeles County", "Orange County", "Sacramento County", "San Diego County"))
df %>% filter(county_nm %in% c("Los Angeles County", "Orange County", "Sacramento County", "San Diego County")) %>% drop_na()
df %>% filter(county_nm %in% c("Los Angeles County", "Orange County", "Sacramento County", "San Diego County"))
df <- df %>% filter(county_nm %in% c("Los Angeles County", "Orange County", "Sacramento County", "San Diego County"))
df
library(reshape2)
data_melted <- melt(df, id.vars=c("county_nm", "year"), variable.name="category", value.name="mean_value")
data_melted
data_melted %>% filter(startswith(category, MEAN_))
data_melted %>% filter(startsWith(category, "MEAN_"))
data_melted %>% filter(startsWith(category, "MEAN_"))
data_melted %>% filter(startswith(category, "MEAN_"))
data_melted %>% filter(category %in% c(MEAN_DOMESTIC, MEAN_INDUSTRIAL, MEAL_COMMERCIAL, MEAN_THERMOELECTRIC))
data_melted %>% filter(category %in% c("MEAN_DOMESTIC", "MEAN_INDUSTRIAL", "MEAL_COMMERCIAL", "MEAN_THERMOELECTRIC"))
data_melted %>% filter(category %in% c("MEAN_DOMESTIC", "MEAN_INDUSTRIAL", "MEAL_COMMERCIAL", "MEAN_THERMOELECTRIC")) %>% drop_na()
data_melted <- data_melted %>% filter(category %in% c("MEAN_DOMESTIC", "MEAN_INDUSTRIAL", "MEAL_COMMERCIAL", "MEAN_THERMOELECTRIC")) %>% drop_na()
ggplot(data_melted, aes(x=year, y=mean_value, color=category, group=interaction(county_nm,category))) +
geom_line() +
geom_point() +
facet_wrap(~ county_nm, scales="free_y") +
theme_minimal() +
labs(title="Mean Values by Category over Years", y="Mean Value", x="Year") +
theme(axis.text.x=element_text(angle=45, hjust=1))
library(tidyverse)
df <- read_tsv("water_use")
df <- df[312:719, ]
colnames(df) <- df[1, ]
df <- df[-(1:2), ]
colnames <- unlist(strsplit(colnames(df), "\t"))
colnames(df) <- "test"
df <- df %>% separate(test, into = colnames, sep = "\t")
colnames(df)
df <- df %>% select(county_nm, year, "Total Population total population of area, in thousands", "Public Supply deliveries to domestic, in Mgal/d", "Public Supply deliveries to commercial, in Mgal/d", "Public Supply deliveries to industrial, in Mgal/d", "Public Supply deliveries to thermoelectric, in Mgal/d", "Public Supply total deliveries, in Mgal/d")
df$`Total Population total population of area, in thousands` <- as.numeric(df$`Total Population total population of area, in thousands`)
df$`Public Supply deliveries to commercial, in Mgal/d` <- as.numeric(df$`Public Supply deliveries to commercial, in Mgal/d`)
df$`Public Supply deliveries to domestic, in Mgal/d` <- as.numeric(df$`Public Supply deliveries to domestic, in Mgal/d`)
df$`Public Supply deliveries to industrial, in Mgal/d` <- as.numeric(df$`Public Supply deliveries to industrial, in Mgal/d`)
df$`Public Supply deliveries to thermoelectric, in Mgal/d` <- as.numeric(df$`Public Supply deliveries to thermoelectric, in Mgal/d`)
df$`Public Supply total deliveries, in Mgal/d` <- as.numeric(df$`Public Supply total deliveries, in Mgal/d`)
df <- df %>% group_by(year) %>% mutate(DOMESTIC = `Public Supply deliveries to domestic, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`) %>% mutate(MEAN_DOMESTIC = mean(DOMESTIC, na.rm = TRUE)) %>% mutate(INDUSTRIAL = `Public Supply deliveries to industrial, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`) %>% mutate(MEAN_INDUSTRIAL = mean(INDUSTRIAL, na.rm = TRUE)) %>% mutate(THERMOELECTRIC = `Public Supply deliveries to thermoelectric, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`) %>% mutate(MEAN_THERMOELECTRIC = mean(THERMOELECTRIC, na.rm = TRUE)) %>% mutate(COMMERCIAL = `Public Supply deliveries to commercial, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`) %>% mutate(MEAN_COMMERCIAL = mean(COMMERCIAL, na.rm = TRUE))
library(reshape2)
data_melted <- melt(df, id.vars=c("county_nm", "year"), variable.name="category", value.name="mean_value")
data_melted <- data_melted %>% filter(category %in% c("MEAN_DOMESTIC", "MEAN_INDUSTRIAL", "MEAL_COMMERCIAL", "MEAN_THERMOELECTRIC")) %>% drop_na()
ggplot(data_melted, aes(x=year, y=mean_value, color=category, group=interaction(county_nm,category))) +
geom_line() +
geom_point() +
facet_wrap(~ county_nm, scales="free_y") +
theme_minimal() +
labs(title="Mean Values by Category over Years", y="Mean Value", x="Year") +
theme(axis.text.x=element_text(angle=45, hjust=1))
data_melted <- data_melted %>% filter(category %in% c("MEAN_DOMESTIC", "MEAN_INDUSTRIAL", "MEAL_COMMERCIAL", "MEAN_THERMOELECTRIC")) %>% drop_na() %>% filter(county_nm == "Los Angeles County")
ggplot(data_melted, aes(x=year, y=mean_value, color=category, group=interaction(county_nm,category))) +
geom_line() +
geom_point() +
facet_wrap(~ county_nm, scales="free_y") +
theme_minimal() +
labs(title="Mean Values by Category over Years", y="Mean Value", x="Year") +
theme(axis.text.x=element_text(angle=45, hjust=1))
ggplot(data_melted, aes(x=year, y=mean_value, color=category, group=interaction(county_nm,category))) +
geom_line() +
geom_point() +
facet_wrap(~ county_nm, scales="free_y") +
theme_minimal() +
labs(title="Mean Percentage of Public Supply Deliveries by Category over 1985-1995", y="Mean Percentage", x="Year") +
theme(axis.text.x=element_text(angle=45, hjust=1))
library(tidyverse)
df <- read_tsv("water_use")
df <- df[312:719, ]
colnames(df) <- df[1, ]
df <- df[-(1:2), ]
colnames <- unlist(strsplit(colnames(df), "\t"))
colnames(df) <- "test"
df <- df %>% separate(test, into = colnames, sep = "\t")
colnames(df)
df <- df %>% select(county_nm, year, "Total Population total population of area, in thousands", "Public Supply deliveries to domestic, in Mgal/d", "Public Supply deliveries to commercial, in Mgal/d", "Public Supply deliveries to industrial, in Mgal/d", "Public Supply deliveries to thermoelectric, in Mgal/d", "Public Supply total deliveries, in Mgal/d")
df$`Total Population total population of area, in thousands` <- as.numeric(df$`Total Population total population of area, in thousands`)
df$`Public Supply deliveries to commercial, in Mgal/d` <- as.numeric(df$`Public Supply deliveries to commercial, in Mgal/d`)
df$`Public Supply deliveries to domestic, in Mgal/d` <- as.numeric(df$`Public Supply deliveries to domestic, in Mgal/d`)
df$`Public Supply deliveries to industrial, in Mgal/d` <- as.numeric(df$`Public Supply deliveries to industrial, in Mgal/d`)
df$`Public Supply deliveries to thermoelectric, in Mgal/d` <- as.numeric(df$`Public Supply deliveries to thermoelectric, in Mgal/d`)
df$`Public Supply total deliveries, in Mgal/d` <- as.numeric(df$`Public Supply total deliveries, in Mgal/d`)
df <- df %>% group_by(year) %>% mutate(DOMESTIC = `Public Supply deliveries to domestic, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`) %>% mutate(MEAN_DOMESTIC = mean(DOMESTIC, na.rm = TRUE)) %>% mutate(INDUSTRIAL = `Public Supply deliveries to industrial, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`) %>% mutate(MEAN_INDUSTRIAL = mean(INDUSTRIAL, na.rm = TRUE)) %>% mutate(THERMOELECTRIC = `Public Supply deliveries to thermoelectric, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`) %>% mutate(MEAN_THERMOELECTRIC = mean(THERMOELECTRIC, na.rm = TRUE)) %>% mutate(COMMERCIAL = `Public Supply deliveries to commercial, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`) %>% mutate(MEAN_COMMERCIAL = mean(COMMERCIAL, na.rm = TRUE))
library(reshape2)
data_melted <- melt(df, id.vars=c("county_nm", "year"), variable.name="category", value.name="mean_value")
data_melted <- data_melted %>% filter(category %in% c("MEAN_DOMESTIC", "MEAN_INDUSTRIAL", "MEAL_COMMERCIAL", "MEAN_THERMOELECTRIC")) %>% drop_na() %>% filter(county_nm == "Los Angeles County")
ggplot(data_melted, aes(x=year, y=mean_value, color=category, group=interaction(county_nm,category))) +
geom_line() +
geom_point() +
facet_wrap(~ county_nm, scales="free_y") +
theme_minimal() +
labs(title="Mean Percentage of Public Supply Deliveries by Category over 1985-1995", y="Mean Percentage", x="Year") +
theme(axis.text.x=element_text(angle=45, hjust=1))
data_melted
df$MEAN_COMMERCIAL
library(reshape2)
data_melted <- melt(df, id.vars=c("county_nm", "year"), variable.name="category", value.name="mean_value")
data_melted <- data_melted %>% filter(category %in% c("MEAN_DOMESTIC", "MEAN_INDUSTRIAL", "MEAN_COMMERCIAL", "MEAN_THERMOELECTRIC")) %>% drop_na() %>% filter(county_nm == "Los Angeles County")
ggplot(data_melted, aes(x=year, y=mean_value, color=category, group=interaction(county_nm,category))) +
geom_line() +
geom_point() +
facet_wrap(~ county_nm, scales="free_y") +
theme_minimal() +
labs(title="Mean Percentage of Public Supply Deliveries by Category over 1985-1995", y="Mean Percentage", x="Year") +
theme(axis.text.x=element_text(angle=45, hjust=1))
data_melted
data_melted$category <- gsub("MEAN_DOMESTIC", "Domestic", data_melted$category)
data_melted$category <- gsub("MEAN_COMMERCIAL", "Commercial", data_melted$category)
data_melted$category <- gsub("MEAN_INDUSTRIAL", "Industrial", data_melted$category)
data_melted$category <- gsub("MEAN_THERMOELECTRIC", "Thermoelectric", data_melted$category)
ggplot(data_melted, aes(x=year, y=mean_value, color=category, group=interaction(county_nm,category))) +
geom_line() +
geom_point() +
facet_wrap(~ county_nm, scales="free_y") +
theme_minimal() +
labs(title="Mean Percentage of Public Supply Deliveries by Category over 1985-1995", y="Mean Percentage", x="Year") +
theme(axis.text.x=element_text(angle=45, hjust=1))
data_melted
data_melted$mean_value <- data_melted$mean_value * 100
ggplot(data_melted, aes(x=year, y=mean_value, color=category, group=interaction(county_nm,category))) +
geom_line() +
geom_point() +
facet_wrap(~ county_nm, scales="free_y") +
theme_minimal() +
labs(title="Mean Percentage of Public Supply Deliveries by Category over 1985-1995", y="Mean Percentage", x="Year") +
theme(axis.text.x=element_text(angle=45, hjust=1))
data_melted
scale(data_melted$mean_value)
data_melted$mean_value_scaled <- scale(data_melted$mean_value)
ggplot(data_melted, aes(x=year, y=mean_value_scaled, color=category, group=interaction(county_nm,category))) +
geom_line() +
geom_point() +
facet_wrap(~ county_nm, scales="free_y") +
theme_minimal() +
labs(title="Mean Percentage of Public Supply Deliveries by Category over 1985-1995", y="Mean Percentage", x="Year") +
theme(axis.text.x=element_text(angle=45, hjust=1))
mean_value
ggplot(data_melted, aes(x=year, y=mean_value, color=category, group=interaction(county_nm,category))) +
geom_line() +
geom_point() +
facet_wrap(~ county_nm, scales="free_y") +
theme_minimal() +
labs(title="Mean Percentage of Public Supply Deliveries by Category over 1985-1995", y="Mean Percentage", x="Year") +
theme(axis.text.x=element_text(angle=45, hjust=1))
library(tidyverse)
df <- read_tsv("water_use")
df
df <- df[101:110, ]
df
library(tidyverse)
df <- read_tsv("water_use")
df <- df[102:110, ]
df
colnames(df) <- df[1, ]
df <- df[-(1:2), ]
df
colnames <- unlist(strsplit(colnames(df), "\t"))
colnames(df) <- "test"
df <- df %>% separate(test, into = colnames, sep = "\t")
df
colnames(df)
df <- df %>% select(year, "Total Population total population of area, in thousands", "Public Supply deliveries to domestic, in Mgal/d", "Public Supply deliveries to commercial, in Mgal/d", "Public Supply deliveries to industrial, in Mgal/d", "Public Supply deliveries to thermoelectric, in Mgal/d", "Public Supply total deliveries, in Mgal/d")
df <- df %>% select(year, "Total Population total population of area, in thousands", "Public Supply deliveries to domestic, in Mgal/d", "Public Supply deliveries to commercial, in Mgal/d", "Public Supply deliveries to industrial, in Mgal/d", "Public Supply deliveries to thermoelectric, in Mgal/d", "Public Supply total deliveries, in Mgal/d")
df$`Total Population total population of area, in thousands` <- as.numeric(df$`Total Population total population of area, in thousands`)
df$`Public Supply deliveries to commercial, in Mgal/d` <- as.numeric(df$`Public Supply deliveries to commercial, in Mgal/d`)
df$`Public Supply deliveries to domestic, in Mgal/d` <- as.numeric(df$`Public Supply deliveries to domestic, in Mgal/d`)
df$`Public Supply deliveries to industrial, in Mgal/d` <- as.numeric(df$`Public Supply deliveries to industrial, in Mgal/d`)
df$`Public Supply deliveries to thermoelectric, in Mgal/d` <- as.numeric(df$`Public Supply deliveries to thermoelectric, in Mgal/d`)
df$`Public Supply total deliveries, in Mgal/d` <- as.numeric(df$`Public Supply total deliveries, in Mgal/d`)
df <- df %>% group_by(year) %>% mutate(DOMESTIC = `Public Supply deliveries to domestic, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`) %>% mutate(MEAN_DOMESTIC = mean(DOMESTIC, na.rm = TRUE)) %>% mutate(INDUSTRIAL = `Public Supply deliveries to industrial, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`) %>% mutate(MEAN_INDUSTRIAL = mean(INDUSTRIAL, na.rm = TRUE)) %>% mutate(THERMOELECTRIC = `Public Supply deliveries to thermoelectric, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`) %>% mutate(MEAN_THERMOELECTRIC = mean(THERMOELECTRIC, na.rm = TRUE)) %>% mutate(COMMERCIAL = `Public Supply deliveries to commercial, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`) %>% mutate(MEAN_COMMERCIAL = mean(COMMERCIAL, na.rm = TRUE))
library(reshape2)
data_melted <- melt(df, id.vars=c("year"), variable.name="category", value.name="mean_value")
data_melted <- data_melted %>% filter(category %in% c("MEAN_DOMESTIC", "MEAN_INDUSTRIAL", "MEAN_COMMERCIAL", "MEAN_THERMOELECTRIC")) %>% drop_na()
data_melted$category <- gsub("MEAN_DOMESTIC", "Domestic", data_melted$category)
data_melted$category <- gsub("MEAN_COMMERCIAL", "Commercial", data_melted$category)
data_melted$category <- gsub("MEAN_INDUSTRIAL", "Industrial", data_melted$category)
data_melted$category <- gsub("MEAN_THERMOELECTRIC", "Thermoelectric", data_melted$category)
data_melted$mean_value <- data_melted$mean_value * 100
data_melted$mean_value_scaled <- scale(data_melted$mean_value)
ggplot(data_melted, aes(x=year, y=mean_value, color=category, group=interaction(county_nm,category))) +
geom_line() +
geom_point() +
facet_wrap(~ county_nm, scales="free_y") +
theme_minimal() +
labs(title="Mean Percentage of Public Supply Deliveries by Category over 1985-1995", y="Mean Percentage", x="Year") +
theme(axis.text.x=element_text(angle=45, hjust=1))
ggplot(data_melted, aes(x=year, y=mean_value, color=category, group=interaction(county_nm,category))) +
geom_line() +
geom_point() +
theme_minimal() +
labs(title="Mean Percentage of Public Supply Deliveries by Category over 1985-1995", y="Mean Percentage", x="Year") +
theme(axis.text.x=element_text(angle=45, hjust=1))
data_melted
data_melted %>% group_by(year)
library(tidyverse)
df <- read_tsv("water_use")
df <- df[102:110, ]
colnames(df) <- df[1, ]
df <- df[-(1:2), ]
colnames <- unlist(strsplit(colnames(df), "\t"))
colnames(df) <- "test"
df <- df %>% separate(test, into = colnames, sep = "\t")
df <- df %>% select(year, "Total Population total population of area, in thousands", "Public Supply deliveries to domestic, in Mgal/d", "Public Supply deliveries to commercial, in Mgal/d", "Public Supply deliveries to industrial, in Mgal/d", "Public Supply deliveries to thermoelectric, in Mgal/d", "Public Supply total deliveries, in Mgal/d")
df$`Total Population total population of area, in thousands` <- as.numeric(df$`Total Population total population of area, in thousands`)
df$`Public Supply deliveries to commercial, in Mgal/d` <- as.numeric(df$`Public Supply deliveries to commercial, in Mgal/d`)
df$`Public Supply deliveries to domestic, in Mgal/d` <- as.numeric(df$`Public Supply deliveries to domestic, in Mgal/d`)
df$`Public Supply deliveries to industrial, in Mgal/d` <- as.numeric(df$`Public Supply deliveries to industrial, in Mgal/d`)
df$`Public Supply deliveries to thermoelectric, in Mgal/d` <- as.numeric(df$`Public Supply deliveries to thermoelectric, in Mgal/d`)
df$`Public Supply total deliveries, in Mgal/d` <- as.numeric(df$`Public Supply total deliveries, in Mgal/d`)
df <- df %>% group_by(year) %>% mutate(DOMESTIC = `Public Supply deliveries to domestic, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`) %>% mutate(MEAN_DOMESTIC = mean(DOMESTIC, na.rm = TRUE)) %>% mutate(INDUSTRIAL = `Public Supply deliveries to industrial, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`) %>% mutate(MEAN_INDUSTRIAL = mean(INDUSTRIAL, na.rm = TRUE)) %>% mutate(THERMOELECTRIC = `Public Supply deliveries to thermoelectric, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`) %>% mutate(MEAN_THERMOELECTRIC = mean(THERMOELECTRIC, na.rm = TRUE)) %>% mutate(COMMERCIAL = `Public Supply deliveries to commercial, in Mgal/d` / `Public Supply total deliveries, in Mgal/d`) %>% mutate(MEAN_COMMERCIAL = mean(COMMERCIAL, na.rm = TRUE))
library(reshape2)
data_melted <- melt(df, id.vars=c("year"), variable.name="category", value.name="mean_value")
data_melted <- data_melted %>% filter(category %in% c("MEAN_DOMESTIC", "MEAN_INDUSTRIAL", "MEAN_COMMERCIAL", "MEAN_THERMOELECTRIC"))
data_melted$category <- gsub("MEAN_DOMESTIC", "Domestic", data_melted$category)
data_melted$category <- gsub("MEAN_COMMERCIAL", "Commercial", data_melted$category)
data_melted$category <- gsub("MEAN_INDUSTRIAL", "Industrial", data_melted$category)
data_melted$category <- gsub("MEAN_THERMOELECTRIC", "Thermoelectric", data_melted$category)
data_melted$mean_value <- data_melted$mean_value * 100
data_melted %>% group_by(year)
data_melted %>% group_by(year) %>% drop_na()
data_melted <- data_melted %>% group_by(year) %>% drop_na()
data_melted
ggplot(data, aes(x = year, y = mean_value, color = category)) +
geom_line() +
geom_point() +
labs(x = "Year", y = "Mean Value", color = "Category") +
theme_minimal()
ggplot(data_melted, aes(x = year, y = mean_value, color = category)) +
geom_line() +
geom_point() +
labs(x = "Year", y = "Mean Value", color = "Category") +
theme_minimal()
ggplot(data_melted, aes(x = year, y = mean_value, color = category)) +
geom_line() +
labs(x = "Year", y = "Mean Value", color = "Category") +
theme_minimal()
ggplot(data_melted, aes(x = year, y = mean_value, color = category)) +
geom_line() +
labs(x = "Year", y = "Mean Value", color = "Category") +
theme_minimal()
ggplot(data_melted, aes(x = year, y = mean_value, color = category)) +
geom_line() +
geom_point() +
labs(x = "Year", y = "Mean Value", color = "Category") +
theme_minimal()
ggplot(data_melted, aes(x = year, y = mean_value, color = category)) +
geom_line() +
geom_point() +
labs(x = "Year", y = "Mean Value", title = "Mean Percentage of Each Category per Year" color = "Category") +
ggplot(data_melted, aes(x = year, y = mean_value, color = category)) +
geom_line() +
geom_point() +
labs(x = "Year", y = "Mean Value", title = "Mean Percentage of Each Category per Year", color = "Category") +
theme_minimal()
ggplot(data_melted, aes(x = year, y = mean_value, color = category, group = category)) +
geom_line() +
geom_point() +
labs(x = "Year", y = "Mean Value", color = "Category") +
theme_minimal()
ggplot(data_melted, aes(x = year, y = mean_value, color = category, group = category)) +
geom_line() +
geom_point() +
labs(x = "Year", y = "Mean Percentage", color = "Category") +
theme_minimal()
ggplot(data_melted, aes(x = year, y = mean_value, color = category, group = category)) +
geom_line() +
geom_point() +
labs(x = "Year", y = "Mean Percentage", title = "Mean Percentage by Category Over Years", color = "Category") +
theme_minimal()
ggplot(data_melted, aes(x = year, y = mean_value, color = category, group = category)) +
geom_line() +
geom_point() +
labs(x = "Year", y = "Mean Percentage", title = "Mean Percentage by Water Sector Over Years", color = "Category") +
theme_minimal()
ggplot(data_melted, aes(x = year, y = mean_value, color = category, group = category)) +
geom_line() +
geom_point() +
labs(x = "Year", y = "Mean Percentage", title = "Mean Percentage by Water Sector (1985-1995)", color = "Category") +
theme_minimal()
ggplot(data_melted, aes(x = year, y = mean_value, color = category, group = category)) +
geom_line() +
geom_point() +
labs(x = "Year", y = "Mean Percentage", title = "Mean Percentage by Water Sector in CA (1985-1995)", color = "Category") +
theme_minimal()
setwd("/Users/lianzou/Downloads/DH101")
